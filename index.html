<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Private Menu Manager</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    
function renderShipItems() {
  const list = document.getElementById("shipItemList");
  list.innerHTML = "";
  if (!app.shipItems || app.shipItems.length === 0) return;
  app.shipItems.forEach(item => {
    const li = document.createElement("li");
    li.className = "border p-2 rounded shadow bg-white dark:bg-gray-800";
    li.innerHTML = `<strong>${item.name}</strong><br>${item.price}<br><em>${item.description}</em>`;
    list.appendChild(li);
  });
}
function addShipItem() {
  const name = prompt("Enter item name:");
  if (!name) return;
  const price = prompt("Enter item price:");
  const desc = prompt("Enter item description:");
  const item = { name, price, description: desc };
  if (!app.shipItems) app.shipItems = [];
  app.shipItems.push(item);
  renderShipItems();
}
</script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
        .scrollable-container {
            overflow-y: auto;
            scrollbar-width: thin;
        }
        
        .scrollable-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollable-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
        }
        
        .scrollable-container::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }
        
        .dark .scrollable-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .dark .scrollable-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        .menu-description p {
            margin-bottom: 0.5rem;
        }
        
        .menu-description p:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-200">
<div id="loadingScreen" style="position:fixed;top:0;left:0;right:0;bottom:0;background:#181827;z-index:99999;display:flex;align-items:center;justify-content:center;color:#fff;font-size:2rem;letter-spacing:2px;">
<span id="loadingMsg">Connecting to secure network…</span>
</div>
<div class="container mx-auto px-4 py-8 max-w-4xl">
<!-- Login Section -->
<div class="flex flex-col items-center justify-center min-h-[50vh]" id="loginSection">
<div class="w-full max-w-md bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
<h1 class="text-2xl font-bold text-center mb-6 text-primary dark:text-primary">Private Menu Manager</h1>
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="password">Password</label>
<input class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="password" placeholder="Enter password" type="password"/>
</div>
<button class="w-full bg-primary hover:bg-opacity-90 text-white font-medium py-2 px-4 rounded-md transition-colors" id="loginBtn">
                    Enter
                </button>
<p class="mt-2 text-red-500 text-sm hidden" id="loginError">Incorrect password. Please try again.</p>
</div>
</div>
<!-- Menu Management Section -->
<div class="hidden" id="menuSection">
<!-- Top bar with mode indicator and logout -->
<div class="flex justify-between items-center mb-6">
<div class="flex items-center" id="viewModeContainer">
<!-- View mode indicator will be inserted here -->
</div>
<button class="text-sm text-gray-600 dark:text-gray-400 hover:text-primary dark:hover:text-primary" id="logoutBtn">
                    Logout
                </button>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" id="editorSection">
<!-- Menu Editor -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
<h2 class="text-xl font-semibold mb-4">Edit Menu</h2>
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="menuItemName">Item Name</label>
<input class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="menuItemName" placeholder="e.g. Cheeseburger" type="text"/>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="menuItemPrice">Standard Price</label>
<input class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="menuItemPrice" placeholder="e.g. $10.99" type="text"/>
<p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Shown to regular viewers</p>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="menuItemVipPrice">VIP Price</label>
<input class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="menuItemVipPrice" placeholder="e.g. $8.99" type="text"/>
<p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Shown to VIP users only</p>
</div>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="menuItemDescription">Description</label>
<textarea class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="menuItemDescription" placeholder="Describe your menu item..." rows="3"></textarea>
<p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Supports markdown formatting</p>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="menuItemCategory">Category</label>
<input class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="menuItemCategory" placeholder="e.g. Main Course" type="text"/>
</div>
<!-- Image Upload Section -->
<div class="mb-4">
<label class="block text-sm font-medium mb-2">Item Image</label>
<div class="flex items-center space-x-4">
<div class="hidden border border-gray-300 dark:border-gray-600 rounded-md overflow-hidden w-20 h-20 flex-shrink-0" id="imagePreviewContainer">
<img alt="Item preview" class="w-full h-full object-cover" id="imagePreview" src=""/>
</div>
<div class="flex-1">
<label class="cursor-pointer bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium py-2 px-4 rounded-md transition-colors flex items-center justify-center" for="menuItemImage">
<svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
                                    Choose Image
                                </label>
<input accept="image/*" class="hidden" id="menuItemImage" type="file"/>
<button class="mt-2 text-sm text-red-500 hover:text-red-700 hidden" id="removeImageBtn">Remove Image</button>
</div>
</div>
<p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            Recommended size: 500x500px or smaller
                        </p>
</div>
<div class="flex space-x-2">
<button class="bg-primary hover:bg-opacity-90 text-white font-medium py-2 px-4 rounded-md transition-colors" id="addMenuItem">Add Item</button>
<button class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors hidden" id="updateMenuItem">Update Item</button>
<button class="bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-700 text-gray-800 dark:text-white font-medium py-2 px-4 rounded-md transition-colors hidden" id="cancelEdit">Cancel</button>
</div>
</div>
<!-- Menu Items List -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
<div class="flex justify-between items-center mb-4">
<h2 class="text-xl font-semibold">Menu Items</h2>
<button class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-3 py-1 rounded" id="organizeCategoriesBtn">Organize Menu</button>
</div>
<div class="divide-y divide-gray-200 dark:divide-gray-700 max-h-96 overflow-y-auto scrollable-container" id="menuItemsList">
<!-- Menu items will be inserted here -->
<p class="py-3 text-gray-500 dark:text-gray-400 text-sm" id="noItemsMessage">No menu items added yet.</p>
</div>
</div>
</div>
<!-- Export/Import Section -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8" id="exportImportSection">
<h2 class="text-xl font-semibold mb-4">Export/Import Menu</h2>
<p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    Due to browser limitations, your menu isn't automatically saved. Use these options to backup your data.
                </p>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors" id="exportMenuBtn">
                            Export Menu Data
                        </button>
</div>
<div>
<button class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-2 px-4 rounded-md transition-colors" id="importMenuBtn">
                            Import Menu Data
                        </button>
</div>
</div>
<div class="mt-4 hidden" id="exportArea">
<p class="text-sm mb-2">Copy this data to save your menu:</p>
<textarea class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="exportOutput" readonly="" rows="4"></textarea>
</div>
<div class="mt-4 hidden" id="importArea">
<p class="text-sm mb-2">Paste your saved menu data here:</p>
<textarea class="w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="importInput" rows="4"></textarea>
<button class="mt-2 bg-green-600 hover:bg-green-700 text-white font-medium py-1 px-3 rounded-md transition-colors text-sm" id="processImportBtn">
                        Process Import
                    </button>
</div>
</div>
<!-- Menu Preview Section -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
<div class="flex justify-between items-center mb-4">
<input class="px-2 py-1 text-lg font-bold border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="menuTitle" placeholder="My Restaurant Menu" type="text" value="My Restaurant Menu"/>
</div>
<div class="mt-4 max-h-[60vh] overflow-y-auto scrollable-container pr-2" id="menuPreview">
<!-- Menu preview will be generated here -->
</div>
</div>
</div>
<!-- All Modals -->
<div class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50" id="modalContainer">
<!-- Category Organization Modal -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 w-full max-w-2xl mx-4 hidden" id="orgModal">
<div class="flex justify-between items-center mb-4">
<h3 class="text-lg font-semibold">Organize Menu</h3>
<button class="modal-close text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
<svg class="h-6 w-6" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</svg>
</button>
</div>
<div class="mb-4 max-h-[60vh] overflow-y-auto scrollable-container" id="categoryOrgList">
<!-- Categories will be listed here -->
</div>
<div class="flex justify-end">
<button class="bg-primary hover:bg-opacity-90 text-white font-medium py-2 px-4 rounded-md transition-colors" id="saveCategoryOrderBtn">Save Order</button>
</div>
</div>
<!-- Import Confirmation Modal -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 max-w-md w-full mx-4 hidden" id="importConfirmModal">
<h3 class="text-lg font-semibold mb-2">Confirm Import</h3>
<p class="text-gray-600 dark:text-gray-400 mb-4">This will replace your current menu data. Continue?</p>
<div class="flex justify-end space-x-2">
<button class="modal-close px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-700">Cancel</button>
<button class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700" id="confirmImportBtn">Confirm</button>
</div>
</div>
<!-- Password Management Modal -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 max-w-md w-full mx-4 hidden" id="passwordModal">
<h3 class="text-lg font-semibold mb-2">Manage Passwords</h3>
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="adminPassword">Admin Password (Full Access)</label>
<input class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="adminPassword" type="password"/>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="vipPassword">VIP Password (Special Pricing)</label>
<input class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="vipPassword" type="password"/>
</div>
<div class="mb-4">
<label class="block text-sm font-medium mb-2" for="viewPassword">View-Only Password</label>
<input class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary dark:bg-gray-700" id="viewPassword" type="password"/>
</div>
<div class="flex justify-end space-x-2">
<button class="modal-close px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-700">Cancel</button>
<button class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90" id="savePasswordBtn">Save Changes</button>
</div>
</div>
<!-- Image Preview Modal -->
<div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 max-w-3xl w-full mx-4 hidden" id="imagePreviewModal">
<h3 class="text-lg font-semibold mb-2">Image Preview</h3>
<div class="flex justify-center items-center my-4 bg-gray-100 dark:bg-gray-700 rounded-lg p-4">
<img alt="Preview" class="max-w-full max-h-[70vh] object-contain" id="modalImagePreview" src=""/>
</div>
<div class="flex justify-end space-x-2">
<button class="modal-close px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-800 dark:text-white rounded-md hover:bg-gray-400 dark:hover:bg-gray-700">Close</button>
</div>
</div>
</div>
</div>
<script>let app = {};

let jsonLoaded = false;
let loadingDone = false;

// Simulate connecting screen for 5-10 seconds
const loadingScreen = document.getElementById("loadingScreen");
const loginView = document.getElementById("loginView");
const loginButton = document.getElementById("loginButton");
if (loginButton) {
  loginButton.disabled = true;
  loginButton.innerText = "Loading...";
}
const delay = Math.floor(5000 + Math.random() * 5000);
setTimeout(() => {
  loadingDone = true;
  if (jsonLoaded) showLogin();
}, delay);

function showLogin() {
  document.getElementById('loadingScreen').style.display = 'none';
  document.getElementById('loginView').style.display = 'block';
  if (loginButton) {
    loginButton.disabled = false;
    loginButton.innerText = "Enter";
  }
}

// Now load menu.json
fetch("menu.json")
  .then(res => res.json())
  .then(data => {
    app = {
      ...data,
      accessMode: null
    };
    jsonLoaded = true;
    if (loadingDone) showLogin();
  })
  .catch(err => {
    console.warn('Could not load menu.json');
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('loginView').style.display = 'block';
    if (loginButton) {
      loginButton.disabled = false;
      loginButton.innerText = "Enter";
    }
  });

// Guard submitLogin so it only works after JSON is loaded
function submitLogin() {
  if (!jsonLoaded || typeof app.login !== "function") {
    alert("Menu not fully loaded yet. Please wait…");
    return;
  }
  const password = document.getElementById("password").value;
  app.login(password);
}


        // Initialize dark mode based on system preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            document.documentElement.classList.toggle('dark', event.matches);
        });

        // Constants
        const ACCESS_MODE = {
            ADMIN: 'admin',
            VIP: 'vip',
            VIEW: 'view',
            SHIPPER: 'shipper'
        };

        // App state
        const 
app = {
    accessMode: null,};

window.addEventListener("DOMContentLoaded", () => {
  fetch("menu.json")
    .then(res => res.json())
    .then(data => {
      console.log('Loaded menu.json:', data);
      app = {
    accessMode: null,
        ...data,
        accessMode: null
      };
    })
    .catch(err => {
      console.error("Failed to load menu.json", err);
      alert("Could not load menu.json");
    });
});

                
                reader.readAsDataURL(file);
            },
            
            removeImage() {
                this.currentImage = null;
                this.elements.imagePreview.src = '';
                this.elements.imagePreviewContainer.classList.add('hidden');
                this.elements.removeImageBtn.classList.add('hidden');
                this.elements.menuItemImage.value = '';
            },
            
            // Menu category organization
            updateCategoryOrder() {
                // Get all unique categories
                const categories = new Set();
                this.menuItems.forEach(item => {
                    categories.add(item.category || 'Uncategorized');
                });
                
                // Add any new categories that aren't in the order yet
                const currentCategories = Array.from(categories);
                currentCategories.forEach(category => {
                    if (!this.categoryOrder.includes(category)) {
                        this.categoryOrder.push(category);
                    }
                });
                
                // Remove any categories that no longer exist
                this.categoryOrder = this.categoryOrder.filter(category => 
                    currentCategories.includes(category)
                );
                
                // If all categories were removed, add any current ones
                if (this.categoryOrder.length === 0) {
                    this.categoryOrder = currentCategories;
                }
            },
            
            renderCategoryOrganizer() {
                this.elements.categoryOrgList.innerHTML = '';
                
                if (this.categoryOrder.length === 0) {
                    this.elements.categoryOrgList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">No categories to organize.</p>';
                    return;
                }
                
                // Create a list of categories with their items
                this.categoryOrder.forEach((category, categoryIndex) => {
                    const categoryItems = this.menuItems.filter(item => 
                        (item.category || 'Uncategorized') === category
                    );
                    
                    // Create category container
                    const categoryContainer = document.createElement('div');
                    categoryContainer.className = 'mb-4 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden';
                    categoryContainer.dataset.category = category;
                    
                    // Create category header
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'bg-gray-100 dark:bg-gray-700 p-3 flex items-center justify-between';
                    
                    // Add category name and controls
                    categoryHeader.innerHTML = `
                        <div class="flex items-center">
                            <h4 class="font-medium">${category}</h4>
                        </div>
                        <div class="flex space-x-1">
                            ${categoryIndex > 0 ? `
                                <button class="move-up-btn p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200" data-category="${category}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                                    </svg>
                                </button>` : ''}
                            ${categoryIndex < this.categoryOrder.length - 1 ? `
                                <button class="move-down-btn p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200" data-category="${category}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                    </svg>
                                </button>` : ''}
                        </div>
                    `;
                    
                    categoryContainer.appendChild(categoryHeader);
                    
                    // Create items list for this category
                    const itemsList = document.createElement('div');
                    itemsList.className = 'p-3';
                    
                    if (categoryItems.length === 0) {
                        itemsList.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm py-2">No items in this category</p>';
                    } else {
                        // Create sortable items list
                        categoryItems.forEach((item, itemIndex) => {
                            const itemElement = document.createElement('div');
                            itemElement.className = 'flex items-center py-2 border-b border-gray-200 dark:border-gray-700 last:border-0';
                            itemElement.dataset.itemIndex = this.menuItems.indexOf(item);
                            
                            itemElement.innerHTML = `
                                <div class="flex-1">
                                    ${item.name}
                                    <span class="text-sm text-gray-500 dark:text-gray-400 ml-2">${item.price || ''}</span>
                                </div>
                                <div class="flex space-x-1">
                                    ${itemIndex > 0 ? `
                                        <button class="move-item-up-btn p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200" data-index="${this.menuItems.indexOf(item)}">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                                            </svg>
                                        </button>` : ''}
                                    ${itemIndex < categoryItems.length - 1 ? `
                                        <button class="move-item-down-btn p-1 text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200" data-index="${this.menuItems.indexOf(item)}">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                            </svg>
                                        </button>` : ''}
                                </div>
                            `;
                            
                            itemsList.appendChild(itemElement);
                        });
                    }
                    
                    categoryContainer.appendChild(itemsList);
                    this.elements.categoryOrgList.appendChild(categoryContainer);
                });
                
                // Add event listeners for category movement
                this.elements.categoryOrgList.querySelectorAll('.move-up-btn[data-category]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const category = btn.dataset.category;
                        const index = this.categoryOrder.indexOf(category);
                        if (index > 0) {
                            // Swap with the category above
                            [this.categoryOrder[index-1], this.categoryOrder[index]] = 
                            [this.categoryOrder[index], this.categoryOrder[index-1]];
                            this.renderCategoryOrganizer();
                        }
                    });
                });
                
                this.elements.categoryOrgList.querySelectorAll('.move-down-btn[data-category]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const category = btn.dataset.category;
                        const index = this.categoryOrder.indexOf(category);
                        if (index < this.categoryOrder.length - 1) {
                            // Swap with the category below
                            [this.categoryOrder[index], this.categoryOrder[index+1]] = 
                            [this.categoryOrder[index+1], this.categoryOrder[index]];
                            this.renderCategoryOrganizer();
                        }
                    });
                });
                
                // Add event listeners for item movement within a category
                this.elements.categoryOrgList.querySelectorAll('.move-item-up-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const itemIndex = parseInt(btn.dataset.index);
                        const item = this.menuItems[itemIndex];
                        const category = item.category || 'Uncategorized';
                        
                        // Get all items in this category
                        const categoryItems = this.menuItems.filter(i => 
                            (i.category || 'Uncategorized') === category
                        );
                        
                        // Find the index within the category items
                        const categoryItemIndex = categoryItems.indexOf(item);
                        
                        if (categoryItemIndex > 0) {
                            // Get the item above in the same category
                            const itemAbove = categoryItems[categoryItemIndex - 1];
                            const itemAboveIndex = this.menuItems.indexOf(itemAbove);
                            
                            // Swap positions in the main array
                            [this.menuItems[itemIndex], this.menuItems[itemAboveIndex]] = 
                            [this.menuItems[itemAboveIndex], this.menuItems[itemIndex]];
                            
                            this.renderCategoryOrganizer();
                        }
                    });
                });
                
                this.elements.categoryOrgList.querySelectorAll('.move-item-down-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const itemIndex = parseInt(btn.dataset.index);
                        const item = this.menuItems[itemIndex];
                        const category = item.category || 'Uncategorized';
                        
                        // Get all items in this category
                        const categoryItems = this.menuItems.filter(i => 
                            (i.category || 'Uncategorized') === category
                        );
                        
                        // Find the index within the category items
                        const categoryItemIndex = categoryItems.indexOf(item);
                        
                        if (categoryItemIndex < categoryItems.length - 1) {
                            // Get the item below in the same category
                            const itemBelow = categoryItems[categoryItemIndex + 1];
                            const itemBelowIndex = this.menuItems.indexOf(itemBelow);
                            
                            // Swap positions in the main array
                            [this.menuItems[itemIndex], this.menuItems[itemBelowIndex]] = 
                            [this.menuItems[itemBelowIndex], this.menuItems[itemIndex]];
                            
                            this.renderCategoryOrganizer();
                        }
                    });
                });
            },
            
            saveCategoryOrder() {
                this.renderMenuItems();
                this.renderMenuPreview();
                this.hideAllModals();
            },
            
            // Menu item management
            addMenuItem() {
                const name = this.elements.menuItemName.value.trim();
                const price = this.elements.menuItemPrice.value.trim();
                const vipPrice = this.elements.menuItemVipPrice.value.trim();
                const description = this.elements.menuItemDescription.value.trim();
                const category = this.elements.menuItemCategory.value.trim();
                
                if (!name) {
                    alert('Please enter a name for the menu item');
                    return;
                }
                
                this.menuItems.push({
                    name,
                    price,
                    vipPrice,
                    description,
                    category: category || 'Uncategorized',
                    image: this.currentImage
                });
                
                this.clearMenuForm();
                this.updateCategoryOrder();
                this.renderMenuItems();
                this.renderMenuPreview();
            },

            editMenuItem(index) {
                if (this.accessMode !== ACCESS_MODE.ADMIN) return;
                
                const item = this.menuItems[index];
                this.elements.menuItemName.value = item.name;
                this.elements.menuItemPrice.value = item.price || '';
                this.elements.menuItemVipPrice.value = item.vipPrice || '';
                this.elements.menuItemDescription.value = item.description;
                this.elements.menuItemCategory.value = item.category;
                
                // Handle image
                if (item.image) {
                    this.elements.imagePreview.src = item.image;
                    this.elements.imagePreviewContainer.classList.remove('hidden');
                    this.elements.removeImageBtn.classList.remove('hidden');
                    this.currentImage = item.image;
                } else {
                    this.elements.imagePreview.src = '';
                    this.elements.imagePreviewContainer.classList.add('hidden');
                    this.elements.removeImageBtn.classList.add('hidden');
                    this.currentImage = null;
                }
                
                this.currentEditingIndex = index;
                
                this.elements.addMenuItem.classList.add('hidden');
                this.elements.updateMenuItem.classList.remove('hidden');
                this.elements.cancelEdit.classList.remove('hidden');
                
                // Scroll to form
                this.elements.menuItemName.scrollIntoView({ behavior: 'smooth' });
            },

            updateMenuItem() {
                if (this.currentEditingIndex < 0) return;
                
                const name = this.elements.menuItemName.value.trim();
                const price = this.elements.menuItemPrice.value.trim();
                const vipPrice = this.elements.menuItemVipPrice.value.trim();
                const description = this.elements.menuItemDescription.value.trim();
                const category = this.elements.menuItemCategory.value.trim();
                
                if (!name) {
                    alert('Please enter a name for the menu item');
                    return;
                }
                
                this.menuItems[this.currentEditingIndex] = {
                    name,
                    price,
                    vipPrice,
                    description,
                    category: category || 'Uncategorized',
                    image: this.currentImage
                };
                
                this.clearMenuForm();
                this.updateCategoryOrder();
                this.renderMenuItems();
                this.renderMenuPreview();
                
                // Reset editing state
                this.currentEditingIndex = -1;
                this.elements.addMenuItem.classList.remove('hidden');
                this.elements.updateMenuItem.classList.add('hidden');
                this.elements.cancelEdit.classList.add('hidden');
            },

            deleteMenuItem(index) {
                if (this.accessMode !== ACCESS_MODE.ADMIN) return;
                
                if (confirm('Are you sure you want to delete this menu item?')) {
                    this.menuItems.splice(index, 1);
                    this.updateCategoryOrder();
                    this.renderMenuItems();
                    this.renderMenuPreview();
                    
                    // If deleting the item being edited, clear the form
                    if (index === this.currentEditingIndex) {
                        this.clearMenuForm();
                        this.currentEditingIndex = -1;
                        this.elements.addMenuItem.classList.remove('hidden');
                        this.elements.updateMenuItem.classList.add('hidden');
                        this.elements.cancelEdit.classList.add('hidden');
                    }
                }
            },

            cancelEdit() {
                this.clearMenuForm();
                this.currentEditingIndex = -1;
                this.elements.addMenuItem.classList.remove('hidden');
                this.elements.updateMenuItem.classList.add('hidden');
                this.elements.cancelEdit.classList.add('hidden');
            },

            clearMenuForm() {
                this.elements.menuItemName.value = '';
                this.elements.menuItemPrice.value = '';
                this.elements.menuItemVipPrice.value = '';
                this.elements.menuItemDescription.value = '';
                this.elements.menuItemCategory.value = '';
                this.elements.menuItemImage.value = '';
                this.elements.imagePreview.src = '';
                this.elements.imagePreviewContainer.classList.add('hidden');
                this.elements.removeImageBtn.classList.add('hidden');
                this.currentImage = null;
            },
            
            // Get price based on access mode
            getPriceForCurrentMode(item) {
                if (this.accessMode === ACCESS_MODE.VIP && item.vipPrice) {
                    return item.vipPrice;
                }
                return item.price;
            },
            
            // Render menu items to editor list
            renderMenuItems() {
                if (this.menuItems.length === 0) {
                    this.elements.noItemsMessage.classList.remove('hidden');
                    this.elements.menuItemsList.innerHTML = '';
                    this.elements.menuItemsList.appendChild(this.elements.noItemsMessage);
                    return;
                }
                
                this.elements.noItemsMessage.classList.add('hidden');
                
                // Group items by category following the category order
                const categorizedItems = this.getCategorizedItems();
                
                // Clear current list
                this.elements.menuItemsList.innerHTML = '';
                
                // Add items by category
                this.categoryOrder.forEach(category => {
                    const items = categorizedItems[category];
                    // Skip empty categories
                    if (!items || items.length === 0) return;
                    
                    const categoryEl = document.createElement('div');
                    categoryEl.className = 'py-2';
                    categoryEl.innerHTML = `
                        <h3 class="font-medium text-primary dark:text-primary">${category}</h3>
                    `;
                    this.elements.menuItemsList.appendChild(categoryEl);
                    
                    items.forEach((item) => {
                        const index = this.menuItems.indexOf(item);
                        
                        const itemEl = document.createElement('div');
                        itemEl.className = 'py-2 pl-3 flex justify-between items-start';
                        
                        // Only show edit and delete buttons in admin mode
                        const actionButtons = (this.accessMode === ACCESS_MODE.ADMIN)
                            ? `<div class="flex space-x-1">
                                <button class="edit-btn p-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300" data-index="${index}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </button>
                                <button class="delete-btn p-1 text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300" data-index="${index}">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                            </div>`
                            : '';

                        const imageThumb = item.image 
                            ? `<div class="flex-shrink-0 mr-3">
                                <div class="image-preview cursor-pointer w-12 h-12 rounded-md overflow-hidden border border-gray-200 dark:border-gray-700" data-src="${item.image}">
                                    <img src="${item.image}" class="w-full h-full object-cover" alt="${item.name}">
                                </div>
                            </div>`
                            : '';

                        // In admin mode, show both prices
                        const priceDisplay = this.accessMode === ACCESS_MODE.ADMIN
                            ? `<div class="text-xs">
                                ${item.price ? `<div>Reg: ${item.price}</div>` : ''}
                                ${item.vipPrice ? `<div class="text-purple-600 dark:text-purple-400">VIP: ${item.vipPrice}</div>` : ''}
                            </div>`
                            : `<span class="ml-2 text-gray-600 dark:text-gray-400">${this.getPriceForCurrentMode(item)}</span>`;
                        
                        itemEl.innerHTML = `
                            <div class="flex items-start">
                                ${imageThumb}
                                <div>
                                    <div class="flex items-center">
                                        <span class="font-medium">${item.name}</span>
                                        ${priceDisplay}
                                    </div>
                                    ${item.description ? `<p class="text-sm text-gray-500 dark:text-gray-400 mt-1">${item.description.substring(0, 60)}${item.description.length > 60 ? '...' : ''}</p>` : ''}
                                </div>
                            </div>
                            ${actionButtons}
                        `;
                        this.elements.menuItemsList.appendChild(itemEl);
                    });
                });
                
                // Add event listeners for edit and delete buttons (only in admin mode)
                if (this.accessMode === ACCESS_MODE.ADMIN) {
                    this.elements.menuItemsList.querySelectorAll('.edit-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            this.editMenuItem(parseInt(btn.dataset.index));
                        });
                    });
                    
                    this.elements.menuItemsList.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            this.deleteMenuItem(parseInt(btn.dataset.index));
                        });
                    });
                }

                // Add event listeners for image previews
                this.elements.menuItemsList.querySelectorAll('.image-preview').forEach(preview => {
                    preview.addEventListener('click', () => {
                        this.showImagePreview(preview.dataset.src);
                    });
                });
            },
            
            // Helper function to group items by category
            getCategorizedItems() {
                const items = {};
                
                // Initialize all categories from the order
                this.categoryOrder.forEach(category => {
                    items[category] = [];
                });
                
                // Group items by category
                this.menuItems.forEach(item => {
                    const category = item.category || 'Uncategorized';
                    if (!items[category]) {
                        items[category] = [];
                    }
                    items[category].push(item);
                });
                
                return items;
            },
            
            // Render menu preview
            renderMenuPreview() {
                const categorizedItems = this.getCategorizedItems();
                
                let previewHTML = `
                    <div class="max-w-4xl mx-auto">
                        <h1 class="text-3xl font-bold text-center mb-8">${this.menuTitle}</h1>
                `;
                
                if (Object.keys(categorizedItems).length === 0 || this.menuItems.length === 0) {
                    previewHTML += `
                        <p class="text-center text-gray-500 dark:text-gray-400 italic">
                            Your menu is empty. Add items to see the preview.
                        </p>
                    `;
                } else {
                    // Add each category in order
                    this.categoryOrder.forEach(category => {
                        const items = categorizedItems[category];
                        // Skip empty categories
                        if (!items || items.length === 0) return;
                        
                        previewHTML += `
                            <div class="mb-8">
                                <h2 class="text-2xl font-semibold border-b-2 border-primary pb-2 mb-4">${category}</h2>
                                <div class="grid grid-cols-1 gap-6">
                        `;
                        
                        // Add items in the category
                        items.forEach(item => {
                            const imageDisplay = item.image 
                                ? `<div class="w-full sm:w-24 h-24 rounded-md overflow-hidden mb-3 sm:mb-0 sm:mr-4 cursor-pointer menu-image-preview" data-src="${item.image}">
                                    <img src="${item.image}" class="w-full h-full object-cover" alt="${item.name}">
                                </div>`
                                : '';

                            const price = this.getPriceForCurrentMode(item);
                            
                            // Apply special styling for VIP prices
                            const priceDisplay = this.accessMode === ACCESS_MODE.VIP && item.vipPrice
                                ? `<div class="ml-4 text-xl font-medium text-purple-600 dark:text-purple-400">${item.vipPrice}</div>`
                                : price ? `<div class="ml-4 text-xl font-medium text-primary">${price}</div>` : '';
                            
                            previewHTML += `
                                <div class="flex flex-col sm:flex-row">
                                    ${imageDisplay}
                                    <div class="flex-1 flex justify-between">
                                        <div class="flex-1">
                                            <h3 class="text-lg font-medium">${item.name}</h3>
                                            ${item.description ? `<div class="mt-1 text-gray-600 dark:text-gray-400 menu-description">${marked.parse(item.description)}</div>` : ''}
                                        </div>
                                        ${priceDisplay}
                                    </div>
                                </div>
                            `;
                        });
                        
                        previewHTML += `
                                </div>
                            </div>
                        `;
                    });
                }
                
                previewHTML += `</div>`;
                this.elements.menuPreview.innerHTML = previewHTML;
                
                // Add event listeners for menu image previews
                this.elements.menuPreview.querySelectorAll('.menu-image-preview').forEach(preview => {
                    preview.addEventListener('click', () => {
                        this.showImagePreview(preview.dataset.src);
                    });
                });
            },
            
            updateMenuTitle() {
                this.menuTitle = this.elements.menuTitle.value;
                this.renderMenuPreview();
            },
            
            // Export/Import functions
            exportMenu() {
                const exportData = {
                    menuItems: this.menuItems,
                    menuTitle: this.menuTitle,
                    categoryOrder: this.categoryOrder,
                    adminPassword: this.adminPassword,
                    vipPassword: this.vipPassword,
                    viewPassword: this.viewPassword
                };
                
                this.elements.exportOutput.value = JSON.stringify(exportData);
                this.elements.exportArea.classList.remove('hidden');
                this.elements.importArea.classList.add('hidden');
                
                // Select the text for easy copying
                this.elements.exportOutput.select();
            },

            showImportMenu() {
                this.elements.importArea.classList.remove('hidden');
                this.elements.exportArea.classList.add('hidden');
                this.elements.importInput.value = '';
            },

            processImport() {
                try {
                    const importText = this.elements.importInput.value.trim();
                    if (!importText) {
                        alert('Please paste the exported menu data');
                        return;
                    }
                    
                    // Try to parse the JSON to validate before showing confirmation
                    JSON.parse(importText);
                    
                    // Show the confirmation dialog
                    this.showModal('importConfirmModal');
                    
                } catch (error) {
                    alert('Invalid import data. Please check the format and try again.');
                }
            },

            confirmImport() {
                try {
                    const importData = JSON.parse(this.elements.importInput.value);
                    
                    if (importData.menuItems && Array.isArray(importData.menuItems)) {
                        this.menuItems = importData.menuItems;
                    }
                    
                    if (importData.menuTitle) {
                        this.menuTitle = importData.menuTitle;
                        this.elements.menuTitle.value = importData.menuTitle;
                    }
                    
                    if (importData.categoryOrder && Array.isArray(importData.categoryOrder)) {
                        this.categoryOrder = importData.categoryOrder;
                    }
                    
                    // Handle password imports
                    if (importData.adminPassword) {
                        this.adminPassword = importData.adminPassword;
                    }
                    
                    if (importData.vipPassword) {
                        this.vipPassword = importData.vipPassword;
                    } 
                    
                    if (importData.viewPassword) {
                        this.viewPassword = importData.viewPassword;
                    }
                    
                    this.updateCategoryOrder();
                    this.renderMenuItems();
                    this.renderMenuPreview();
                    
                    this.elements.importArea.classList.add('hidden');
                    this.hideAllModals();
                    
                    alert('Menu imported successfully!');
                } catch (error) {
                    alert('Error importing menu: ' + error.message);
                }
            }
        };

        // Initialize the application
        
        fetch('menu.json')
          .then(res => res.json())
          .then(data => {
      console.log('Loaded menu.json:', data);
            if (data.menuItems) app.menuItems = data.menuItems;
            if (data.menuTitle) app.menuTitle = data.menuTitle;
            if (data.categoryOrder) app.categoryOrder = data.categoryOrder;
            document.getElementById('menuTitle').value = app.menuTitle;
            app.renderMenuItems();
            app.renderMenuPreview();
          })
          .catch(err => console.warn("menu.json load failed:", err));

        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
    
function showMainMenu() {
  document.getElementById("menuEditor").style.display = "block";
  document.getElementById("shipMenuEditor").style.display = "none";
}
function showShipMenu() {
  document.getElementById("menuEditor").style.display = "none";
  document.getElementById("shipMenuEditor").style.display = "block";
}
function addShipItem() {
  const name = prompt("Enter item name:");
  if (!name) return;
  const price = prompt("Enter item price:");
  const desc = prompt("Enter item description:");
  const item = { name, price, description: desc };
  app.shipItems.push(item);
  app.renderShipItems();
}
app.renderShipItems = function() {
  const list = document.getElementById("shipItemList");
  list.innerHTML = "";
  this.shipItems.forEach((item, idx) => {
    const li = document.createElement("li");
    li.className = "border p-2 rounded shadow bg-white dark:bg-gray-800";
    li.innerHTML = `<strong>${item.name}</strong><br>${item.price}<br><em>${item.description}</em>`;
    list.appendChild(li);
  });
}

function submitLogin() {
  const password = document.getElementById('password').value;
  app.login(password);
}

function submitLogin() {
  const password = document.getElementById("password").value;
  app.login(password);
}

app.login = function(password) {
  if (password === this.adminPassword) {
    this.accessMode = ACCESS_MODE.ADMIN;
    document.getElementById("loginView").style.display = "none";
    document.getElementById("adminView").style.display = "block";
    this.renderMenuItems();
  } else if (password === this.vipPassword) {
    this.accessMode = ACCESS_MODE.VIP;
    document.getElementById("loginView").style.display = "none";
    document.getElementById("vipView").style.display = "block";
  } else if (password === this.viewPassword) {
    this.accessMode = ACCESS_MODE.VIEW;
    document.getElementById("loginView").style.display = "none";
    document.getElementById("viewerView").style.display = "block";
  } else if (password === this.shipPassword) {
    this.accessMode = ACCESS_MODE.SHIPPER;
    document.getElementById("loginView").style.display = "none";
    document.getElementById("shipMenuEditor").style.display = "block";
    this.renderShipItems();
  } else {
    alert("Invalid password");
    document.getElementById("loginView").style.display = "block";
  }
};

app.renderShipItems = function() {
  const list = document.getElementById("shipItemList");
  list.innerHTML = "";
  this.shipItems.forEach(item => {
    const li = document.createElement("li");
    li.className = "border p-2 rounded shadow bg-white dark:bg-gray-800";
    li.innerHTML = `<strong>${item.name}</strong><br>${item.price}<br><em>${item.description}</em>`;
    list.appendChild(li);
  });
};

function addShipItem() {
  const name = prompt("Enter item name:");
  if (!name) return;
  const price = prompt("Enter item price:");
  const desc = prompt("Enter item description:");
  const item = { name, price, description: desc };
  app.shipItems.push(item);
  app.renderShipItems();
}

function submitLogin() {
  if (typeof app.login === "function") {
    const password = document.getElementById("password").value;
    app.login(password);
  } else {
    alert("Menu not fully loaded yet. Please wait...");
  }
}
window.addEventListener("load", () => {
  setTimeout(() => {
    document.getElementById("loginButton").disabled = false;
    document.getElementById("loginButton").innerText = "Enter";
  }, 300); // wait for fetch to resolve
});

function // logDebug(msg) {
  const panel = document.getElementById("/* debugPanel */");
  panel.textContent += msg + "\n";
}

// patch fetch to show debug info
window.addEventListener("DOMContentLoaded", () => {
  fetch("menu.json")
    .then(res => res.json())
    .then(data => {
      app = {
        ...data,
        accessMode: null
      };
      // logDebug("✅ Loaded menu.json");
      // logDebug("🔐 Passwords:");
      // logDebug(" - admin: " + app.adminPassword);
      // logDebug(" - vip: " + app.vipPassword);
      // logDebug(" - view: " + app.viewPassword);
      // logDebug(" - ship: " + app.shipPassword);
      document.getElementById("loginButton").disabled = false;
      document.getElementById("loginButton").innerText = "Enter";
    })
    .catch(err => {
      // logDebug("❌ Failed to load menu.json");
      console.error("menu.json error:", err);
    });
});

function submitLogin() {
  const password = document.getElementById("password").value;
  // logDebug("🧪 Entered password: " + password);
  if (typeof app.login === "function") {
    app.login(password);
  } else {
    // logDebug("❌ app.login not defined");
    alert("App not ready yet.");
  }
}

// Failsafe: always remove loading after 15s
setTimeout(() => {
  if (document.getElementById('loadingScreen')) {
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('loginView').style.display = 'block';
    if (document.getElementById('loginButton')) {
      document.getElementById('loginButton').disabled = false;
      document.getElementById('loginButton').innerText = "Enter";
    }
  }
}, 15000);

// Show a warning if fetch hasn't finished in 30s
setTimeout(() => {
  if (!jsonLoaded) {
    const warn = document.getElementById('loadWarn');
    if (warn) {
      warn.textContent = "⚠️ Warning: menu.json could not be loaded. Please refresh or check your connection.";
      warn.classList.remove('hidden');
    }
  }
}, 30000);
</script>
<script>
function compressImage(file, callback) {
  const reader = new FileReader();
  reader.onload = function (event) {
    const img = new Image();
    img.onload = function () {
      const canvas = document.createElement("canvas");
      const maxWidth = 1024;
      const scaleSize = maxWidth / img.width;
      canvas.width = maxWidth;
      canvas.height = img.height * scaleSize;
      const ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      canvas.toBlob(function (blob) {
        const compressedFile = new File([blob], file.name, { type: "image/jpeg", lastModified: Date.now() });
        callback(compressedFile);
      }, "image/jpeg", 0.7);
    };
    img.src = event.target.result;
  };
  reader.readAsDataURL(file);
}

// Override upload function if it exists
document.addEventListener('DOMContentLoaded', () => {
  const imageInput = document.getElementById('itemImage');
  if (imageInput) {
    imageInput.addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;
      compressImage(file, function (compressed) {
        const reader = new FileReader();
        reader.onload = function (e) {
          document.getElementById('itemImagePreview').src = e.target.result;
          document.getElementById('itemImagePreview').style.display = 'block';
          app.tempImageData = e.target.result;
        };
        reader.readAsDataURL(compressed);
      });
    });
  }
});
</script>
<script>
// Override export button to trigger a JSON download
document.addEventListener('DOMContentLoaded', () => {
  const exportBtn = document.getElementById('exportMenuBtn');
  if (exportBtn) {
    exportBtn.addEventListener('click', function () {
      const exportData = {
        menuTitle: app.menuTitle,
        categoryOrder: app.categoryOrder,
        menuItems: app.menuItems,
        adminPassword: app.adminPassword,
        vipPassword: app.vipPassword,
        viewPassword: app.viewPassword,
        socials: app.socials || {}
      };
      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = 'menu.json';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    });
  }
});
</script>
<div class="p-4 bg-white dark:bg-gray-900 border rounded mt-4" id="shipMenuEditor" style="display:none">
<h2 class="text-xl font-bold mb-3">Shipping Menu</h2>
<label class="block mb-2 font-semibold">Ship Menu Title:
        <input class="w-full border px-2 py-1 rounded" id="shipMenuTitle" type="text"/>
</label>
<div class="mt-4">
<button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" onclick="addShipItem()">+ Add Ship Item</button>
</div>
<ul class="mt-4 grid gap-2" id="shipItemList"></ul>
</div>
</body>
</html>
